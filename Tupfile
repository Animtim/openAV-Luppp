
# Linking / final steps for Luppp

# GENERAL
LDFLAGS +=`pkg-config --libs   jack sndfile cairomm-1.0 ntk ntk_images`

# CONFIGURE
ifeq (@(LUPPP_BUILD_TESTS),y)
LDFLAGS +=-lgcov
endif

# LINK
: src/*.o |> g++ %f $(LDFLAGS) -o %o |> luppp


# POST
ifeq (@(LUPPP_BUILD_TESTS),y)

# run the tests: the program quits itself after tests are finished
: | luppp |> ./luppp && touch lupppDone.running |> lupppDone.running

# Analyse coverage using gcov
#: foreach src/*.gcda | lupppDone.running |> echo %b |> %B.gcno

#: foreach src/*.c | lupppDone.running |> gcov -r -b %f |> %B.c.gcov
#: foreach src/*.gcda | lupppDone.running |> gcov -r -b %f |> %B.cxx.gcov | %B.hxx.gcov

# Create lcov info file
#: src/*.gcno |> lcov --directory . -zerocounters &&\
#    lcov --directory . --capture --output-file lcov.info |>

# Generate HTML report
#: |> genhtml lcov.info |>


endif
