
# Linking / final steps for Luppp

# GENERAL
LDFLAGS +=`pkg-config --libs   jack sndfile cairomm-1.0 ntk ntk_images`

# CONFIGURE
ifeq (@(LUPPP_BUILD_TESTS),y)
LDFLAGS +=-lgcov
endif

# LINK
: src/*.o |>  ^c^  g++ %f $(LDFLAGS) -o %o |> luppp


# POST
ifeq (@(LUPPP_BUILD_TESTS),y)

# run the tests:
#  Luppp quits after tests are finished
#  gcov scrapes .gcna / .gcdo files, produces .gcov files
#  cp source files into dir: needed for analysis by lcov
#  lcov scrapes .gcov files into lcov.info
#  genhtml produces index.html from lcov.info

: | luppp |> ./luppp &&\
  gcov -r -b * &&\
  cp -r *.cxx ../../src/* ./ &&\
  #lcov --directory . -zerocounters && \
  lcov --directory . --capture --output-file lcov.info && \
  genhtml lcov.info |>

# Analyse coverage using gcov
#: foreach src/*.gcda | lupppDone.running |> echo %b |> %B.gcno

#: foreach src/*.c | lupppDone.running |> gcov -r -b %f |> %B.c.gcov
#: foreach src/*.gcda | lupppDone.running |> gcov -r -b %f |> %B.cxx.gcov | %B.hxx.gcov

# cp -r *.cxx ../../src/* ./

# Create lcov info file
#: src/*.gcno |> lcov --directory . -zerocounters && lcov --directory . --capture --output-file lcov.info |>

# Generate HTML report
#: |> genhtml lcov.info |>


endif
